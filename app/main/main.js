(()=>{"use strict";function e(e){return function(o,n){return n?r.dialog.showMessageBox(n,{type:e,...o}):r.dialog.showMessageBox({type:e,...o})}}function o(e=h){var o;let n=new URL("./index.html",f).toString();g=new r.BrowserWindow({...w,...e}),g.loadURL(n),g.once("ready-to-show",(()=>{!function(){var e,o,n;null!==(e=g)&&void 0!==e&&e.isMinimized()&&(null===(n=g)||void 0===n||n.restore());null===(o=g)||void 0===o||o.show()}()})),null===(o=g)||void 0===o||o.on("closed",(e=>{g=null}))}var n,t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o)};const r=require("electron"),i=require("path");n=t.n(i);const l={none:e("none"),info:e("info"),error:e("error"),question:e("question"),warning:e("warning")},a=r.app.getAppPath(),s=(n().join(a,"main/"),n().join(a,"renderer/")),c={scheme:"electron",protocol:"electron"},p=new RegExp("^electron://"),d={setDefaultProtocol:function(e){let o=!1;return e?r.app.isDefaultProtocolClient(e)?[!0,()=>{r.app.removeAsDefaultProtocolClient(e)}]:(r.app.removeAsDefaultProtocolClient(e),o=r.app.setAsDefaultProtocolClient(e),[o,()=>{r.app.removeAsDefaultProtocolClient(e)}]):[o,null]},watchMacProtocol:function(){r.app.on("open-url",((e,o)=>{p.test(o)&&l.info({message:"Mac protocol 自定义协议打开",detail:`链接:${o}`})}))},watchWindowProtocol:function(){r.app.on("second-instance",((e,o)=>{o.forEach((e=>{p.test(e)&&l.info({message:"window protocol 自定义协议打开",detail:`链接:${e}`})}))}))},registerFileProtocol:function(e){r.protocol.registerFileProtocol(e,((o,t)=>{const r=s;let i=n().join(r,o.url.replace(`${e}://`,""));return t({path:decodeURIComponent(i)})}))},registerSchemesAsPrivileged:function(e){return r.protocol.registerSchemesAsPrivileged([{scheme:e,privileges:{bypassCSP:!0}}])}},u=require("url"),w={show:!1,webPreferences:{webSecurity:!1,devTools:!0,nodeIntegration:!0,contextIsolation:!1,nativeWindowOpen:!0},backgroundColor:"#ffffff",maximizable:!1,resizable:!1,fullscreenable:!0,fullscreen:!1,simpleFullscreen:!1};let f=(0,u.pathToFileURL)(s).toString();let g=null;const h={width:800,height:600};r.ipcMain.handle("window:create",((e,{url:o,...n})=>function(e,{id:o,data:n,...t}){e=[f,e].join("#");let i=r.BrowserWindow.getFocusedWindow(),l=null,a=n;return t.parent&&i&&(t.parent=i),r.ipcMain.handle([o,"init"].join(":"),(()=>a)),r.ipcMain.handle([o,"update"].join(":"),((e,o)=>(a=o,!0))),new Promise(((n,i)=>{l=new r.BrowserWindow({...w,...t}),l.loadURL(e),l.once("ready-to-show",(()=>{l&&function(e){e.isMinimized()&&e.restore(),e.show()}(l)})),l.on("closed",(e=>{l=null,r.ipcMain.removeHandler([o,"init"].join(":")),r.ipcMain.removeHandler([o,"update"].join(":")),n({id:o,data:a})}))}))}(o,n))),console.log("electron main process running."),console.log("electron main process argvs",process.argv);(new class{constructor(e=c){var o,n,t;t=void 0,(n="config")in(o=this)?Object.defineProperty(o,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[n]=t,this.config=e}bindAppEvent(){r.app.on("activate",(()=>{0===r.BrowserWindow.getAllWindows().length&&o()})),r.app.on("window-all-closed",(()=>{"darwin"!==process.platform&&r.app.quit()}))}async registerProtocol(){let e=this.config;d.setDefaultProtocol(e.protocol),d.registerSchemesAsPrivileged(e.scheme),await r.app.whenReady(),d.registerFileProtocol(e.scheme)}async init(){this.bindAppEvent(),this.registerProtocol(),await r.app.whenReady(),o()}}).init()})();